---
const { lang = "en" } = Astro.props;

const navItems = lang === "en" ? [
	{ name: "Mission", href: `/${lang}#mission` },
	{ name: "Clinical Trials", href: `/${lang}#trials` },
	{ name: "Participation", href: `/${lang}#participation` },
	{ name: "Contact", href: `/${lang}#contact` },
] : [
	{ name: "Misión", href: `/${lang}#mission` },
	{ name: "Ensayos Clínicos", href: `/${lang}#trials` },
	{ name: "Participación", href: `/${lang}#participation` },
	{ name: "Contacto", href: `/${lang}#contact` },
];

const toggleLang = lang === "en" ? "es" : "en";
const toggleLabel = lang === "en" ? "ES" : "EN";
---

<header id="main-header" class="fixed top-0 left-0 right-0 z-[100] transition-all duration-500 py-4">
	<div class="container mx-auto px-4">
		<nav class="glass-premium rounded-full px-4 md:px-8 py-3 flex items-center justify-between">
			<!-- Logo -->
			<a href={`/${lang}`} class="flex items-center gap-3 group">
				<img src="/logo.png" alt="Echelon Clinical Research" class="h-10 md:h-12 w-auto object-contain" />
			</a>

			<!-- Desktop Nav -->
			<div class="hidden lg:flex items-center gap-2">
				{navItems.map(item => (
					<a href={item.href} class="px-5 py-2 text-sm font-bold text-slate-500 hover:text-primary transition-all rounded-full hover:bg-slate-100/50">
						{item.name}
					</a>
				))}
			</div>

			<!-- Actions -->
			<div class="flex items-center gap-3">
				<a 
					href={Astro.url.pathname.replace(`/${lang}`, `/${toggleLang}`)}
					class="w-10 h-10 flex items-center justify-center rounded-full border border-slate-200 text-xs font-bold text-slate-500 hover:text-primary hover:bg-slate-50 transition-all font-bold"
				>
					{toggleLabel}
				</a>
				
				<a 
					href={`/${lang}#contact`}
					class="hidden sm:inline-flex items-center justify-center px-8 py-3 rounded-full bg-accent text-white text-sm font-black uppercase tracking-widest shadow-xl shadow-accent/20 hover:bg-primary transition-all duration-500 hover:scale-105 active:scale-95"
				>
					{lang === "en" ? "Join Registry" : "Unirse al Registro"}
				</a>
				
				<button id="mobile-menu-toggle" class="lg:hidden w-10 h-10 flex items-center justify-center rounded-full bg-slate-100 text-primary relative z-[110]" aria-label="Menu">
					<div class="hamburger-icon w-5 h-4 relative">
            <span class="absolute top-0 left-0 w-full h-0.5 bg-current transition-all duration-300"></span>
            <span class="absolute top-1/2 -translate-y-1/2 left-0 w-full h-0.5 bg-current transition-all duration-300"></span>
            <span class="absolute bottom-0 left-0 w-full h-0.5 bg-current transition-all duration-300"></span>
          </div>
				</button>
			</div>
		</nav>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 bg-white/95 backdrop-blur-2xl z-[105] opacity-0 pointer-events-none transition-all duration-500 lg:hidden">
      <div class="flex flex-col items-center justify-center h-full space-y-10 p-10">
        <img src="/logo.png" alt="Logo" class="h-16 w-auto mb-10 opacity-0 transform translate-y-8 transition-all mobile-nav-link" />
        {navItems.map((item, i) => (
          <a href={item.href} class="mobile-nav-link text-4xl font-black text-slate-300 hover:text-primary transition-all duration-300 transform translate-y-8 opacity-0" style={`transition-delay: ${i * 50}ms`}>
            {item.name}
          </a>
        ))}
        <a href={`/${lang}#contact`} class="mobile-nav-link mt-10 px-12 py-5 rounded-full bg-primary text-white font-black text-lg uppercase tracking-widest shadow-2xl shadow-primary/20 transition-all duration-300 transform translate-y-8 opacity-0" style={`transition-delay: ${navItems.length * 50}ms`}>
          {lang === "en" ? "Join Registry" : "Unirse al Registro"}
        </a>
      </div>
    </div>
	</div>
</header>

<script>
	const header = document.getElementById('main-header');
	const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
	const mobileMenu = document.getElementById('mobile-menu');
  const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
  const spans = mobileMenuToggle?.querySelectorAll('span');
	
	window.addEventListener('scroll', () => {
		if (window.scrollY > 50) {
			header?.classList.add('py-2');
			header?.classList.remove('py-4');
		} else {
			header?.classList.add('py-4');
			header?.classList.remove('py-2');
		}
	});

	// Mobile menu logic
	if (mobileMenuToggle && mobileMenu) {
		mobileMenuToggle.addEventListener('click', () => {
			const isOpen = mobileMenu.classList.contains('opacity-100');
			
      if (!isOpen) {
        // Open
        mobileMenu.classList.remove('pointer-events-none', 'opacity-0');
        mobileMenu.classList.add('opacity-100');
        document.body.style.overflow = 'hidden';
        
        // Icon animation
        if (spans) {
          spans[0].style.transform = 'rotate(45deg) translate(5px, 6px)';
          spans[1].style.opacity = '0';
          spans[2].style.transform = 'rotate(-45deg) translate(5px, -6px)';
        }

        // Links animation
        mobileNavLinks.forEach(link => {
          link.classList.remove('translate-y-8', 'opacity-0');
          link.classList.add('translate-y-0', 'opacity-100');
        });
      } else {
        // Close
        mobileMenu.classList.add('opacity-0', 'pointer-events-none');
        mobileMenu.classList.remove('opacity-100');
        document.body.style.overflow = '';
        
        // Icon animation reset
        if (spans) {
          spans[0].style.transform = '';
          spans[1].style.opacity = '1';
          spans[2].style.transform = '';
        }

        // Links animation reset
        mobileNavLinks.forEach(link => {
          link.classList.add('translate-y-8', 'opacity-0');
          link.classList.remove('translate-y-0', 'opacity-100');
        });
      }
		});

    // Close on link click
    mobileNavLinks.forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu.classList.add('opacity-0', 'pointer-events-none');
        mobileMenu.classList.remove('opacity-100');
        document.body.style.overflow = '';
        if (spans) {
          spans[0].style.transform = '';
          spans[1].style.opacity = '1';
          spans[2].style.transform = '';
        }
      });
    });
	}
</script>

<style>
	header {
		will-change: padding;
	}
</style>
